{% extends "base.html" %}
{% block title %}User Home - JN Records{% endblock %}

{% block content %}
<div style="position: fixed; top: 10px; left: 10px; z-index: 999;">
    <a href="{{ url_for('routes.dashboard') }}"
        style="top: 15px; left: 15px; z-index: 1000;
          background-color: white;
          border: 2px solid black;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          color: black;"
    title="Return to Dashboard">
    <i class="fas fa-house"></i>
    </a>
  </div>

  <div class="container mt-5">
    <div class="card p-4 mb-4 shadow-sm">
        <h3 class="mb-2">Welcome, {{ user.username }}</h3>
        <p class="mb-1"><strong>Email:</strong> {{ user.email }}</p>
        <p class="mb-0">
            <strong>Password:</strong> ••••••••
            <a href="{{ url_for('routes.change_password') }}" class="btn btn-sm btn-outline-secondary ms-3">Change Password</a>
        </p>
    </div>


    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
              <div class="card-header bg-dark text-white">
                <strong>Recently Viewed</strong>
              </div>
              <div class="card-body overflow-auto" style="max-height: 300px;">
                {% if viewed %}
                <table class="table table-sm table-striped mb-0">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Time</th>
                      <th>Action</th>
                      <th>File</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for log in viewed %}
                      <tr>
                        <td>{{ log.timestamp.strftime('%Y-%m-%d') }}</td>
                        <td>{{ log.timestamp.strftime('%H:%M:%S') }}</td>
                        <td>{{ log.action.split(':')[0] }}</td>
                        <td>{{ log.action.split(':')[1].strip() }}</td>
                        <td>
                            <a href="{{ url_for('routes.open_contract', filename=log.action.split(':')[1].strip()) }}"
                               class="btn btn-sm btn-primary" target="_blank">
                              Open
                            </a>
                          </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
                {% else %}
                  <p>No viewed documents yet.</p>
                {% endif %}
              </div>
            </div>
          </div>
        
        <!-- Uploaded or Edited -->
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
              <div class="card-header bg-dark text-white">
                <strong>Uploaded or Edited</strong>
              </div>
              <div class="card-body overflow-auto" style="max-height: 300px;">
                {% if uploads_edits %}
                <table class="table table-sm table-striped mb-0">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Time</th>
                      <th>Action</th>
                      <th>File</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for log in uploads_edits %}
                      <tr>
                        <td>{{ log.timestamp.strftime('%Y-%m-%d') }}</td>
                        <td>{{ log.timestamp.strftime('%H:%M:%S') }}</td>
                        <td>{{ log.action.split(':')[0] }}</td>
                        <td>{{ log.action.split(':')[1].strip() }}</td>
                        <td>
                            <a href="{{ url_for('routes.open_contract', filename=log.action.split(':')[1].strip()) }}"
                               class="btn btn-sm btn-primary" target="_blank">
                              Open
                            </a>
                          </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
                {% else %}
                  <p>No uploads or edits yet.</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
</div>
{% endblock %}

